<!--
  Generated template for the ChatPage page.

  See http://ionicframework.com/docs/components/#navigation for more info on
  Ionic pages and navigation.
-->
<ion-header>
  <ion-navbar>
    <button ion-button menuToggle start>
        <ion-icon name="menu"></ion-icon>
      </button>
  <ion-title>Chat</ion-title>
  <!--<button ion-button end class="button button-clear" (click)="manageGroups();">Manage Groups</button>-->
  <button ion-button end class="button button-clear" (click)="showNewGroupPopUp();">New Group</button>
  <button ion-button end class="button button-clear" (click)="showNewMessagePopUp('2');">New Message</button>
</ion-navbar>

</ion-header>


<ion-content padding>
  <h1 class="contentTitle">Chat</h1>
  <ion-item>
                
    <ion-searchbar placeholder="Search for contacts" (input)="searchChat()" [(ngModel)]="searchText" 
    name="searchText" id="searchText"></ion-searchbar>
</ion-item>
<ion-list *ngIf="!isApp">
  <div *ngFor="let group of chatGroups">
    <div *ngIf="group.val().deletedFor.indexOf(firebaseUserId) < 0" >
                <div *ngIf="group.val().isGroup==0">
            
                <ion-list>
       
                    <ion-item class="item item-avatar item-text-wrap"  *ngIf="firebaseUserId==group.val().fromFbUserId||firebaseUserId==group.val().toFbUserId" 
                    (click)="chatDetail(group.val().groupId,group.val().fromFbUserId,group.val().fromUserName,group.val().toUserName,1)">
                      <div  *ngIf="firebaseUserId==group.val().fromFbUserId">
                        <div  *ngFor="let user of users">
                          <div *ngIf="user.fbId==group.val().toFbUserId && user.isOnline==0">              
                          <div class="userstatus-offline">Offline</div>
                          
                          </div>
                          <div  *ngIf="user.fbId==group.val().toFbUserId && user.isOnline==1">              
                          <div class="userstatus-online">Online</div>
            
                          </div>
                          <div  *ngIf="user.fbId==group.val().toFbUserId">              
                         
                              <!--<img src="{{this.sharedServiceObj.imgBucketUrl}}{{user.image_url}}" class="custom-avatar" *ngIf="user.image_url!=null&&user.image_url!=undefined&&user.image_url!=''"/>
                              <img src={{noImgUrl}} class="custom-avatar" 
                              *ngIf="user.image_url==null||user.image_url==''"/>-->
                              <img src={{this.sharedServiceObj.imgBucketUrl}}{{user.image_url}} class="custom-avatar" 
                              (error)="imgChat.src = this.sharedServiceObj.noImageUrl" #imgChat/>
                          </div>
                        </div>
                        
                      </div> 
            
                      <div  *ngIf="firebaseUserId==group.val().toFbUserId">
                        <div  *ngFor="let user of users"> <div  *ngIf="user.fbId==group.val().fromFbUserId && user.isOnline==0">
                          <div class="userstatus-offline">Offline</div>
                         
                          </div>
                          <div  *ngIf="user.fbId==group.val().fromFbUserId && user.isOnline==1">              
                          <div class="userstatus-online">Online</div>
                         
                          </div>
                           <div  *ngIf="user.fbId==group.val().fromFbUserId">              
                              <img src={{this.sharedServiceObj.imgBucketUrl}}{{user.image_url}} class="custom-avatar" 
                              (error)="imgChat1.src = this.sharedServiceObj.noImageUrl" #imgChat1/>
                              <!--<img src="{{this.sharedServiceObj.imgBucketUrl}}{{user.image_url}}" class="custom-avatar" *ngIf="user.image_url!=null&&user.image_url!=undefined&&user.image_url!=''"/>
                              <img src={{noImgUrl}} class="custom-avatar" 
                              *ngIf="user.image_url==null||user.image_url==''"/>-->
                          
                          </div>
                        </div>
                        
                      </div>  
            
                      <div class="chat-info">
                        <div *ngIf="firebaseUserId==group.val().fromFbUserId">
                        <span class="msgdate">{{convertToDate(group.val().modifiedDate) | date : "shortTime"}}</span>
                      
                        <h2>{{group.val().toUserName}}<span class="msgcounter"  *ngIf="group['unreadMsgs']">({{group['unreadMsgs']}})</span></h2>
                        </div>
                        <div  *ngIf="firebaseUserId==group.val().toFbUserId">
                        <span class="msgdate">{{convertToDate(group.val().modifiedDate) | date : "shortTime"}}</span>
                       
                        <h2 class="item-text-wrap">{{group.val().fromUserName}}<span class="msgcounter"  *ngIf="group['unreadMsgs']">({{group['unreadMsgs']}})</span></h2>
                        </div>
                        <p [innerHTML]="group.val().message"></p>
                       
                      </div>
            
        <button ion-button color="danger" item-right class="roundedOption btn-del" (click)="deleteGroupChat(group.val().groupId,group.key);"  *ngIf="group.val().isGroup==1&&group.val().deletedFor.indexOf(firebaseUserId) < 0"><ion-icon name="md-close"></ion-icon>Delete Chat</button>
        <button ion-button color="danger" item-right class="roundedOption btn-del" (click)="deleteGroupChat(group.val().groupId,group.key);"  *ngIf="group.val().isGroup==0&&group.val().deletedFor.indexOf(firebaseUserId) < 0"><ion-icon name="md-close"></ion-icon>Delete Chat</button>
        <button ion-button color="primary" item-right class="roundedOption btn-settings" (click)="manageGroups(group.val().groupId)" *ngIf="group.val().isGroup==1"><ion-icon name="md-create"></ion-icon>Group Members</button>
                      </ion-item>
                  </ion-list>
                </div>
            
                <div  *ngIf="group.val().isGroup==1">
                  <div  *ngFor="let groupMember of groupMembersData">
                    <ion-list  *ngIf="groupMember.userId==firebaseUserId&&groupMember.groupId==group.val().groupId">
                      <ion-item class="item item-avatar item-text-wrap" 
                      (click)="chatDetail(group.val().groupId,group.val().fromFbUserId,group.val().fromUserName,group.val().toUserName,2)">        
                        
                           <!--<img src="{{group.val().groupImage}}" class="chat-profile-group" />                    
                        <span class="chat-info mike">-->
                          <img src={{group.val().groupImage}} class="custom-avatar" 
                            (error)="imgGroup.src = this.sharedServiceObj.noImageUrl" #imgGroup/>
                          <span class="msgdate">{{convertToDate(group.val().modifiedDate) | date : "shortTime"}}</span>
                          <h2>{{group.val().groupTitle}}<span class="msgcounter" *ngIf="group['unreadMsgs']">({{group['unreadMsgs']}})</span></h2>
                          <p ng-bind-html="group.val().message"></p>          
            
        <button ion-button color="danger" item-right class="roundedOption btn-del" (click)="deleteGroupChat(group.val().groupId,group.key);"  *ngIf="group.val().isGroup==1&&group.val().deletedFor.indexOf(firebaseUserId) < 0"><ion-icon name="md-close"></ion-icon>Delete Chat</button>
        <button ion-button color="danger" item-right class="roundedOption btn-del" (click)="deleteGroupChat(group.val().groupId,group.key);"  *ngIf="group.val().isGroup==0&&group.val().deletedFor.indexOf(firebaseUserId) < 0"><ion-icon name="md-close"></ion-icon>Delete Chat</button>
        <button ion-button color="primary" item-right class="roundedOption btn-settings" (click)="manageGroups(group.val().groupId)" *ngIf="group.val().isGroup==1"><ion-icon name="md-create"></ion-icon>Group Members</button>
                      </ion-item>
                    </ion-list>
                  </div>
                </div>  
        
              </div>
    </div>
</ion-list>
<ion-list *ngIf="isApp">
  <div *ngFor="let group of chatGroups">
  <div *ngIf="group.val().deletedFor.indexOf(firebaseUserId) < 0">
 
            <div *ngIf="group.val().isGroup==0">
        
            <ion-list>
                
                <ion-item class="item item-avatar item-text-wrap"  *ngIf="firebaseUserId==group.val().fromFbUserId||firebaseUserId==group.val().toFbUserId" 
                    (click)="chatDetail(group.val().groupId,group.val().fromFbUserId,group.val().fromUserName,group.val().toUserName,2)">  
                    <ion-item-sliding>
                      <ion-item>
                    <div  *ngIf="firebaseUserId==group.val().fromFbUserId">
                    <div  *ngFor="let user of users">
                      <div *ngIf="user.fbId==group.val().toFbUserId && user.isOnline==0">              
                      <div class="userstatus-offline">Offline</div>
                      
                      </div>
                      <div  *ngIf="user.fbId==group.val().toFbUserId && user.isOnline==1">              
                      <div class="userstatus-online">Online</div>
        
                      </div>
                      <div  *ngIf="user.fbId==group.val().toFbUserId">              
                     
                          <!--<img src="{{this.sharedServiceObj.imgBucketUrl}}{{user.image_url}}" class="custom-avatar" 
                          *ngIf="user.image_url!=null&&user.image_url!=undefined&&user.image_url!=''"/>
                          <img src={{noImgUrl}} class="custom-avatar" 
                          *ngIf="user.image_url==null||user.image_url==''"/>-->
                          <img src="{{this.sharedServiceObj.imgBucketUrl}}{{user.image_url}}" class="custom-avatar" 
                          (error)="imgUser.src = this.sharedServiceObj.noImageUrl" #imgUser/>
                      </div>
                    </div>
                    
                  </div> 
        
                  <div  *ngIf="firebaseUserId==group.val().toFbUserId">
                    <div  *ngFor="let user of users"> <div  *ngIf="user.fbId==group.val().fromFbUserId && user.isOnline==0">
                      <div class="userstatus-offline">Offline</div>
                     
                      </div>
                      <div  *ngIf="user.fbId==group.val().fromFbUserId && user.isOnline==1">              
                      <div class="userstatus-online">Online</div>
                     
                      </div>
                       <div  *ngIf="user.fbId==group.val().fromFbUserId">              
                          <img src="{{this.sharedServiceObj.imgBucketUrl}}{{user.image_url}}" class="custom-avatar" 
                          (error)="imgUser1.src = this.sharedServiceObj.noImageUrl" #imgUser1/>
                          <!--<img src="{{this.sharedServiceObj.imgBucketUrl}}{{user.image_url}}" class="custom-avatar" *ngIf="user.image_url!=null&&user.image_url!=undefined&&user.image_url!=''"/>
                          <img src={{noImgUrl}} class="custom-avatar" 
                          *ngIf="user.image_url==null||user.image_url==''"/>-->
                      
                      </div>
                    </div>
                    
                  </div>  
        
                  <div class="chat-info">
                    <div *ngIf="firebaseUserId==group.val().fromFbUserId">
                    <span class="msgdate">{{convertToDate(group.val().modifiedDate) | date : "shortTime"}}</span>
                  
                    <h2>{{group.val().toUserName}}<span class="msgcounter"  *ngIf="group['unreadMsgs']">({{group['unreadMsgs']}})</span></h2>
                    </div>
                    <div  *ngIf="firebaseUserId==group.val().toFbUserId">
                    <span class="msgdate">{{convertToDate(group.val().modifiedDate) | date : "shortTime"}}</span>
                   
                    <h2 class="item-text-wrap">{{group.val().fromUserName}}<span class="msgcounter"  *ngIf="group['unreadMsgs']">({{group['unreadMsgs']}})</span></h2>
                    </div>
                    <p [innerHTML]="group.val().message"></p>
                   
                  </div>
                </ion-item>
                <ion-item-options side="right">
                  <button ion-button color="danger" class="roundedOption btn-del"  (click)="deleteGroupChat(group.val().groupId,group.key);"  *ngIf="group.val().isGroup==1&&group.val().deletedFor.indexOf(firebaseUserId) < 0"><ion-icon name="md-close"></ion-icon>Delete Chat</button>
                  <button ion-button color="danger" class="roundedOption btn-del"  (click)="deleteGroupChat(group.val().groupId,group.key);"  *ngIf="group.val().isGroup==0&&group.val().deletedFor.indexOf(firebaseUserId) < 0"><ion-icon name="md-close"></ion-icon>Delete Chat</button>
                  <button ion-button color="primary" item-right class="roundedOption btn-settings" (click)="manageGroups(group.val().groupId)" *ngIf="group.val().isGroup==1"><ion-icon name="md-create"></ion-icon>Group Members</button>
                </ion-item-options>
                </ion-item-sliding>
                  </ion-item>
              </ion-list>
            </div>
        
            <div  *ngIf="group.val().isGroup==1">
              <div  *ngFor="let groupMember of groupMembersData">
                <ion-item-sliding  *ngIf="groupMember.userId==firebaseUserId&&groupMember.groupId==group.val().groupId">
                  <ion-item class="item item-avatar item-text-wrap" 
                  (click)="chatDetail(group.val().groupId,group.val().fromFbUserId,group.val().fromUserName,group.val().toUserName,2)">        
                    
                       <img src="{{group.val().groupImage}}" class="chat-profile-group" />                    
                    <span class="chat-info mike">
                      <span class="msgdate">{{convertToDate(group.val().modifiedDate) | date : "shortTime"}}</span>
                      <h2>{{group.val().groupTitle}}<span class="msgcounter" *ngIf="group['unreadMsgs']">({{group['unreadMsgs']}})</span></h2>
                      <p ng-bind-html="group.val().message"></p>          
                    </span>
        
        
                  </ion-item>
                  <ion-item-options side="right">
                    <button ion-button color="danger" class="roundedOption btn-del"  (click)="deleteGroupChat(group.val().groupId,group.key);"  *ngIf="group.val().isGroup==1&&group.val().deletedFor.indexOf(firebaseUserId) < 0"><ion-icon name="md-close"></ion-icon>Delete Chat</button>
                    <button ion-button color="danger" class="roundedOption btn-del"  (click)="deleteGroupChat(group.val().groupId,group.key);"  *ngIf="group.val().isGroup==0&&group.val().deletedFor.indexOf(firebaseUserId) < 0"><ion-icon name="md-close"></ion-icon>Delete Chat</button>
                    <button ion-button color="primary" item-right class="roundedOption btn-settings" (click)="manageGroups(group.val().groupId)" *ngIf="group.val().isGroup==1"><ion-icon name="md-create"></ion-icon>Group Members</button>
                  </ion-item-options>
                </ion-item-sliding>
              </div>
            </div>    
          </div>
</div>
</ion-list>

</ion-content>
